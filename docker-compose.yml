nginx:
    build: docker/nginx
    restart: always
    links:
        - java
    volumes_from:
        - images_data
        - logs_data
java:
    image: lazyants/filecessor
    restart: always
    volumes_from:
        - images_data
    links:
        - db
        - rabbit
    environment:
        MONGO_HOST: db
        RABBIT_HOST: rabbit
        RABBIT_PORT: 5672
        APPLICATION_MEDIA_DIRECTORY_PATH: /media/
db:
    image: umputun/mongo-auth
    restart: always
    volumes_from:
        - db_data
    environment:
        MONGO_PASSWD: app
rabbit:
    image: rabbitmq:3
    restart: always
    volumes_from:
        - db_data

#data containers
images_data:
    image: debian:jessie
    volumes:
        - /var/tmp/uploads
        - /var/cache/uploads
        - ./media:/media
    tty: true
db_data:
    image: debian:jessie
    volumes:
        - /data/db
        - /var/lib/rabbitmq
    tty: true
logs_data:
    image: debian:jessie
    volumes:
        - /var/log/nginx
        - /var/cache/nginx
        - /var/log/filecessor
    tty: true